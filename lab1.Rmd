---
title: "Lab 1"
author: "Carmen Canedo"
output:
  pdf_document: default
  html_notebook: default
editor_options:
  chunk_output_type: inline
---

# Necessary Packages
```{r, message=FALSE}
library(mdsr)
library(XML)
library(OpenStreetMap)
library(lubridate)
library(ggmap)
library(raster)
library(sp)
```

# Loading in data
```{r}
walking <- read.csv("lab-1.csv", header = TRUE)
```

# Cleaning data
Getting rid of unnecessary
```{r}
walking <- walking %>% 
  select(-type, -desc, -name)
```

Making column names simpler
```{r}
walking <- walking %>% 
  rename(altitude = altitude..ft.) %>% 
  rename(speed = speed..mph.) %>% 
  rename(distance_mi = distance..mi.) %>% 
  rename(distance_int_ft = distance_interval..ft.)
```

# Summary stats
We will be working with a full population
```{r}
columns <- c(walking$time, walking$latitude, walking$longitude, walking$altitude, walking$speed, walking$distance_mi, walking$distance_int_ft)

sum_latitude <- favstats( ~ latitude, data = walking)
sum_latitude

sum_longitude <- favstats( ~ longitude, data = walking)
sum_longitude

sum_altitude <- favstats( ~ altitude, data = walking)
sum_altitude

sum_speed <- favstats( ~ speed, data = walking)
sum_speed

sum_distance_mi <- favstats( ~ distance_mi, data = walking)
sum_distance_mi

distance_int_ft <- as.numeric(walking$distance_int_ft)
sum_dist_int_ft <- favstats( ~ distance_int_ft, data = walking)
sum_dist_int_ft
```

Question 1:
The standard deviation is larger for latitude.

Question 2:
This tells us that the latitude moves farther from the mean latitude.

# Latitude v. Longitude Scatter Plot
x = longitude
y = latitude
group by = speed
color scheme = red to blue scale

```{r}
lat_v_long <- walking %>%
  ggplot(aes(x = longitude, y = latitude)) +
  geom_point(alpha = 0.8, aes(color = speed), size = 3) +
  scale_color_gradient(low = "blue", high = "red") +
  theme_minimal() +
  labs(title = "Longitude versus Latitude",
       subtitle = "Carmen Canedo",
       caption = "STAT 202, Summer 2020",
       x = "Longitude",
       y = "Latitude",
       color = "Speed (mph)")

lat_v_long
```

# Adding Linear Regression
x = longitude
y = latitude

Let's calculate the linear regression model
```{r}
lat_v_long <- lat_v_long +
  geom_smooth(method = "lm")

lat_v_long
```

# Details
+ Equation for regression line and the correlation coefficient
+ Is the line of best fit a good tool to estimate the path traveled? Why or why not?
+ How does the correlation help you answer part b?

# Mapping
I followed exercises from [here](https://rpubs.com/ials2un/gpx1)

# Function to shift vectors
```{r}
shift_vec <- function(vector, shift) {
  if (length(vec) <= abs(shift)) {
    rep(NA, length(vec))
  } else {
    if (shift >= 0) {
      c(rep(NA, shift), vec[1:(length(vec) - shift)])
    } else {
      c(vec[(abs(shift) + 1):length(vec)])
    }
  }
}
```

# Reading in GPX file
```{r}
options(digits = 10)

# Parsing the GPX file
parsed_file <- htmlTreeParse(file = "lab-1-raw-data.gpx", error = function(...) {}, useInternalNodes = TRUE)

# Get all elevations, times, and coordinates via the repsective xpath
#altitudes <- as.numeric(xpathSApply(parsed_file, path = "//trkkpt/ele", xmlValue))
times <- xpathSApply(parsed_file, path = "//trkpt/time", xmlValue)
coords <- xpathSApply(parsed_file, path = "//trkpt", xmlAttrs)

# Extract latitude and longitude from the coordinates
lats <- as.numeric(coords["lat",])
lons <- as.numeric(coords["lon",])
```

# Putting into dataframe
```{r}
geodf <- data.frame(lat = lats, lon = lons, time = times)
```

# Plotting the map
```{r}
lat <- c(min(geodf$lat), max(geodf$lat))
lon <- c(min(geodf$lon), max(geodf$lon))

# Compute bounding box
bbox <- make_bbox(lon, lat)

box1 <- bbox %>% 
  get_stamenmap(maptype = "watercolor", source = "stamen")
```

Now adding details
```{r}
ggmap(box1) +
  geom_point(data = geodf,
             aes(x = lon, y = lat), size = 1, alpha = 0.7) +
  labs(x = "Longitude", y = "Latitude", title = "Walking Path")
```

